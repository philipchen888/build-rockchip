This is to build sdcard image for orangepi5plus, rockpi4b and roc-rk3328-cc:

Parts needed:
1. orangepi5plus and rockpi4b.
2. WD Black SN770 1TB NVMe SSD.  ( install kernel and rootfs in NVMe SSD )
3. Sandisk 64GB micro sdcard.    ( install u-boot in on board spi )
4. Host PC with ubuntu 24.
5. M.2 NVMe SSD enclosure.
6. EMMC module.                  ( install android on EMMC )
7. USB2 SATA SSD
8. usb3 stick.
9. ASUS USB-BT500 bluetooth usb dongle.

Steps to build orangepi5plus sdcard image:

1. git clone https://github.com/philipchen888/build-rockchip.git
   sudo apt update
   sudo apt upgrade
   sudo apt-get install build-essential git libssl-dev nmap net-tools libncurses-dev dnsutils vsftpd ftp binfmt-support qemu-user-static scons libdbus-glib-1-dev libbluetooth-dev python3-dev python3-pip python3-setuptools libcurl4-openssl-dev gettext dbus-x11 chrpath diffstat gawk texinfo curl flex bison device-tree-compiler swig libmpc-dev debootstrap debhelper kpartx gdisk devscripts isolinux po4a libgnutls28-dev mtools python-is-python3 python3-pyelftools u-boot-tools gcc-aarch64-linux-gnu

2. Install live-build:
   sudo apt-get install debootstrap debhelper kpartx gdisk devscripts isolinux po4a live-build

   lb --version ( 3.0~a57-1 /usr/bin/lb )

   For trixie and bookworm:
   wget http://deb.debian.org/debian/pool/main/l/live-build/live-build_20250505.tar.xz
   tar xvf live-build_20250505.tar.xz
   cd work
   sudo make install
   lb --version ( 20250505 /usr/bin/lb )

3. cd ~/build-rockchip/uboot  ( Download u-boot to spi )
   Program spi flash with RK3588_NOR_FLASH.img for uefi boot:
   Build RK3588_NOR_FLASH.img from git clone https://github.com/edk2-porting/edk2-rk3588.git --recursive
   cd edk2-rk3588; ./build.sh --device orangepi-5plus --release Release
   The result is in ~/build-rockchip/uboot/edk2-rk3588/RK3588_NOR_FLASH.img
 
   Prepare spi nor flash for extlinux boot: 
   Download u-boot-v2024.07-orangepi5-plus-spi.bin
   Erase spi flash
   Program spi flash with u-boot-v2024.07-orangepi5-plus-spi.bin
   Boot NVMe without sdcard.

4. cd ~/build-rockchip/linux ( Compile mainline kernel )
   git clone --depth=1 --branch v6.18 https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git
   vi ./linux/arch/arm64/configs/defconfig ( enable NVMe )

   For roc-rk3328-cc:
   vi linux/arch/arm64/boot/dts/rockchip/rk3328-roc.dtsi ( change i2c1 uart1 spi0 pwm2 )
   make MYCHIP=rk3328 kernel

   For opi5+:
   vi ./linux/arch/arm64/boot/dts/rockchip/rk3588-base.dtsi ( change gpu )
   vi linux/arch/arm64/boot/dts/rockchip/rk3588-orangepi-5.dtsi ( change i2c2 uart3 spi0 pwm14 )
   make MYCHIP=opi5 kernel

   For rockpi4b:
   vi ./linux/arch/arm64/boot/dts/rockchip/rk3399-rock-pi-4.dtsi ( change i2c7 uart4 spi2 pwm1 )
   make MYCHIP=rockpi4b kernel

   The results are in ./linux/tmp/lib/modules/*
                      ./linux/tmp/boot/*

5. cd ~/build-rockchip/rootfs-bookworm  ( Compile debian bookworm rootfs )
   make rootfs
   The results are in ./linaro-rootfs.img linaro-esp.img
   make clean

6. cd ~/build-rockchip/rootfs-trixie  ( Compile debian trixie rootfs )
   make rootfs
   The results are in ./linaro-rootfs.img linaro-esp.img
   make clean

7. cd ~/build-rockchip/rootfs-ubuntu-noble  ( Compile ubuntu-noble rootfs )
   make rootfs
   The results are in ./linaro-rootfs.img linaro-esp.img
   make clean

8. cd ~/build-rockchip/rootfs-ubuntu-plucky  ( Compile ubuntu-plucky rootfs )
   make rootfs
   The results are in ./linaro-rootfs.img linaro-esp.img
   make clean

9. cd ~/build-rockchip/bookworm-gnome  ( Build debian bookworm gnome-desktop image )
   Plugin NVME-SSD/sdcard/emmc/USB2-SATA-SSD to PC.
   sudo ./mksdcardimg.sh
   Eject NVME-SSD/sdcard/emmc/USB2-SATA-SSD from PC.

10. cd ~/build-rockchip/trixie-gnome    ( Build debian trixie gnome-desktop image )
    Plugin NVME-SSD/sdcard/emmc/USB2-SATA-SSD to PC.
    sudo ./mksdcardimg.sh
    Eject NVME-SSD/sdcard/emmc/USB2-SATA-SSD from PC.

11. cd ~/build-rockchip/ubuntu-noble  ( Build ubuntu-noble image )
    Plugin NVME-SSD/sdcard/emmc/USB2-SATA-SSD to PC.
    sudo ./mksdcardimg.sh
    sudo mount /dev/sda2 /mnt
    sudo cp ./rtlbt/* /mnt/lib/firmware/rtl_bt && sync && sudo umount /mnt
    Eject NVME-SSD/sdcard/emmc/USB2-SATA-SSD from PC.

12. cd ~/build-rockchip/ubuntu-plucky  ( Build ubuntu-plucky image )
    Plugin NVME-SSD/sdcard/emmc/USB2-SATA-SSD to PC.
    sudo ./mksdcardimg.sh
    sudo mount /dev/sda2 /mnt
    sudo cp ./rtlbt/* /mnt/lib/firmware/rtl_bt && sync && sudo umount /mnt
    Eject NVME-SSD/sdcard/emmc/USB2-SATA-SSD from PC.

13. cd ~/build-rockchip/android       ( Build android image )

14. cd ~/build-rockchip/bookworm-flightaware  ( flightaware in bookworm )

15. cd ~/build-rockchip/yocto         ( Build yocto desktop image )

16. cd ~/build-rockchip/buildroot     ( Build buildroot image )

17. cd ~/build-rockchip/bookworm-gpio ( Build bookworm gpio tests )

18. cd ~/build-rockchip/fedora        ( Build fedora image )

19. cd ~/build-rockchip/ubuntu-uefi   ( Build ubuntu-uefi image )

20. cd ~/build-rockchip/bookworm-uefi ( Build bookworm-uefi image )

21. cd ~/build-rockchip/trixie-uefi   ( Build trixie-uefi image )
